<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kembara Bahasa Arab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* Front Page Styles */
        .front-page {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-image: url('https://arleta.site/interactivelink/1262/Make-an-an-magic-syou-1.jpeg');
            background-size: cover;
            background-position: center;
            font-family: 'Arial', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .front-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 0;
        }

        .front-page h1 {
            color: #d4a017;
            font-size: 4em;
            font-family: 'Georgia', serif;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5), 0 0 25px #e67e22;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            position: relative;
            z-index: 1;
            animation: fadeInDown 1s ease-out;
        }

        .front-page .container {
            text-align: center;
            background: rgba(255, 245, 224, 0.85);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            border: 2px solid #d4a017;
            position: relative;
            z-index: 1;
            animation: fadeInUp 1s ease-out;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }

        .front-page .container:hover {
            transform: translateY(-5px) rotateX(5deg);
        }

        .front-page p {
            color: #4a2c0b;
            font-size: 1.2em;
            margin-bottom: 30px;
            animation: fadeIn 1.5s ease-out;
        }

        .start-button {
            padding: 15px 30px;
            font-size: 1.5em;
            color: white;
            background-color: #e67e22;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.4);
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
        }

        .start-button:hover {
            background-color: #d35400;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(230, 126, 34, 0.6);
        }

        .start-button:active {
            transform: scale(0.95);
        }

        .start-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(30deg);
            transition: all 0.5s;
        }

        .start-button:hover::after {
            left: 100%;
        }

        /* Learning Module Styles */
        :root {
            --primary: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --desert-green: #2e7d32;
        }
        
        .learning-module {
            background-image: url('https://arleta.site/interactivelink/1262/Make-an-an-magic-syou-1.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #f7e7b4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Tajawal', sans-serif;
            overflow-x: hidden;
            position: relative;
            color: #1f2937;
        }
        
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.2em;
            line-height: 1.8;
        }
        
        .character img {
            width: 90px;
            height: 90px;
            transition: all 0.3s ease;
            border-radius: 50%;
            border: 3px solid transparent;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .character.active img {
            transform: scale(1.1);
            border-color: #800000;
            box-shadow: 0 0 20px rgba(128, 0, 0, 0.5);
            animation: pulse 1.5s infinite;
        }
        
        .dialog-container {
            width: 100%;
            max-width: 48rem;
            margin-bottom: 1.5rem;
            perspective: 1000px;
        }
        
        .dialog {
            opacity: 0;
            transform: translateY(20px) rotateX(10deg);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background-color: rgba(249, 250, 251, 0.95);
            border-radius: 0.75rem;
            padding: 1.25rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 
                        0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: flex-start;
            gap: 1.25rem;
            width: fit-content;
            max-width: 100%;
            min-height: 100px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .dialog.active {
            opacity: 1;
            transform: translateY(0) rotateX(0);
        }
        
        .dialog img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 2px solid white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dialog-content {
            flex: 1;
            min-width: 0;
        }
        
        .typing {
            border-right: 2px solid;
            animation: blink 0.7s infinite;
        }
        
        @keyframes blink {
            50% { border-color: transparent; }
        }
        
        .btn {
            transform: scale(1);
            transition: all 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: scale(1.03);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-next {
            background-color: var(--secondary);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-next:hover {
            background-color: #059669;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }
        
        .btn-next::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
            transition: all 0.3s;
        }
        
        .btn-next:hover::after {
            left: 100%;
        }
        
        .quiz-button {
            transform: scale(1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .quiz-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.5s;
        }
        
        .quiz-button:hover::before {
            left: 100%;
        }
        
        .quiz-result {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .quiz-result.show {
            opacity: 1;
            max-height: 300px;
            animation: fadeIn 0.5s ease-out;
        }
        
        .question-container {
            display: none;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.5s ease;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .question-container.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
            animation: fadeInUp 0.5s ease-out;
        }
        
        .progress-bar {
            height: 8px;
            transition: width 0.5s ease;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .highlight {
            background-color: rgba(245, 158, 11, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .answer-btn.correct {
            background-color: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3);
        }
        
        .answer-btn.incorrect {
            background-color: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
            box-shadow: 0 2px 5px rgba(239, 68, 68, 0.3);
        }
        
        .final-score {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0.5rem 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--accent);
            opacity: 0;
            animation: confetti-fall 5s linear forwards;
            z-index: 100;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .title-text {
            color: var(--desert-green);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            -webkit-text-stroke: 1px #1b5e20;
        }
        
        .home-button {
            background-color: #d4a017;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(212, 160, 23, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .home-button:hover {
            background-color: #b8860b;
            transform: scale(1.03);
            box-shadow: 0 6px 15px rgba(212, 160, 23, 0.4);
        }
        
        .home-button:active {
            transform: scale(0.98);
        }
        
        .home-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
            transition: all 0.3s;
        }
        
        .home-button:hover::after {
            left: 100%;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            from, 20%, 40%, 60%, 80%, to {
                animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
            }
            0% {
                opacity: 0;
                transform: scale3d(.3, .3, .3);
            }
            20% {
                transform: scale3d(1.1, 1.1, 1.1);
            }
            40% {
                transform: scale3d(.9, .9, .9);
            }
            60% {
                opacity: 1;
                transform: scale3d(1.03, 1.03, 1.03);
            }
            80% {
                transform: scale3d(.97, .97, .97);
            }
            to {
                opacity: 1;
                transform: scale3d(1, 1, 1);
            }
        }
        
        /* Responsive styles */
        @media (max-width: 640px) {
            .character img {
                width: 70px;
                height: 70px;
            }
            
            .dialog img {
                width: 50px;
                height: 50px;
            }
            
            .dialog {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }

            .front-page h1 {
                font-size: 2.5em;
            }

            .front-page .container {
                padding: 20px;
                width: 90%;
            }

            .front-page p {
                font-size: 1em;
            }

            .start-button {
                padding: 10px 20px;
                font-size: 1.2em;
            }
            
            .home-button {
                padding: 8px 16px;
                font-size: 1em;
            }
            
            .title-text {
                font-size: 1.8rem;
            }
        }

        /* Hidden class for toggling visibility */
        .hidden {
            display: none;
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center z-50 transition-opacity duration-500">
        <div class="spinner mb-4"></div>
        <p class="text-gray-700 font-medium">Memuatkan Kembara Bahasa Arab...</p>
    </div>

    <!-- Front Page -->
    <div id="front-page" class="front-page">
        <h1>Kembara Bahasa Arab</h1>
        <div class="container">
            <p>Selamat datang ke pengembaraan pembelajaran Bahasa Arab yang menyeronokkan! Tekan butang di bawah untuk memulakan.</p>
            <button class="start-button" onclick="startGame()">Mulakan Kembara</button>
        </div>
    </div>

    <!-- Learning Module (initially hidden) -->
    <div id="learning-module" class="learning-module hidden">
        <div class="fixed inset-0 bg-black bg-opacity-10 pointer-events-none"></div>
        
        <div class="absolute top-4 left-4">
            <button class="home-button" onclick="goToHome()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>
                Kembali ke Muka Depan
            </button>
        </div>
        
        <h1 class="text-4xl font-bold text-center title-text mb-6 mt-4 font-[Tajawal] drop-shadow-lg animate__animated animate__fadeIn">
            <span class="arabic-text">الباب الأول: الاسم</span><br>
            BAB 1 : I'SM
        </h1>

        <!-- Story Section -->
        <div id="story-section" class="w-full max-w-3xl mx-auto px-4">
            <div class="flex justify-center space-x-6 mb-8">
                <div class="character text-center" id="ali-character">
                    <img src="https://arleta.site/interactivelink/1262/IMG_20250705_124642.png" alt="Ali" class="floating">
                    <p class="text-lg font-semibold text-gray-800 mt-2">Ali</p>
                </div>
                <div class="character text-center" id="aisyah-character">
                    <img src="https://arleta.site/interactivelink/1262/IMG_20250705_124629.png" alt="Aisyah" class="floating" style="animation-delay: 0.5s;">
                    <p class="text-lg font-semibold text-gray-800 mt-2">Aisyah</p>
                </div>
            </div>

            <div class="dialog-container relative">
                <!-- Dialogues will be inserted here by JavaScript -->
            </div>

            <div class="text-center mt-6">
                <button id="next-btn" class="btn btn-next py-3 px-8 rounded-full text-lg font-semibold">
                    Seterusnya
                </button>
            </div>
        </div>

        <!-- Quiz Section (initially hidden) -->
        <div id="quiz-section" class="hidden w-full max-w-3xl mx-auto px-4">
            <div class="absolute top-4 left-4">
                <button class="home-button" onclick="goToHome()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Kembali ke Muka Depan
                </button>
            </div>
            
            <div class="flex items-center mb-6">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <span id="progress-text" class="ml-3 text-sm font-medium text-gray-700">0/10</span>
            </div>

            <!-- Question containers will be inserted here by JavaScript -->
            <div id="quiz-questions-container" class="space-y-6"></div>

            <div class="text-center mt-8">
                <button id="next-question-btn" class="btn btn-next py-3 px-8 rounded-full text-lg font-semibold hidden">
                    Soalan Seterusnya
                </button>
            </div>
        </div>

        <div id="final-result" class="hidden mt-6 p-6 bg-white rounded-xl shadow-xl text-center w-full max-w-3xl mx-auto backdrop-blur-sm bg-opacity-90 animate__animated animate__fadeInUp">
            <div class="absolute top-4 left-4">
                <button class="home-button" onclick="goToHome()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Kembali ke Muka Depan
                </button>
            </div>
            
            <div class="flex justify-center mb-4">
                <svg id="result-icon" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 id="result-title" class="font-bold text-2xl text-gray-800"></h3>
            <div class="final-score" id="score-text"></div>
            <p id="result-message" class="text-gray-600 mb-4"></p>
            
            <div id="result-details" class="mt-6 text-left bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto"></div>
            
            <button onclick="resetQuiz()" class="btn bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-8 rounded-full mt-6 font-semibold transition-all">
                Cuba Lagi
            </button>
            
            <button onclick="shareResult()" class="btn bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-full mt-4 ml-4 font-semibold transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                </svg>
                Kongsi Keputusan
            </button>
        </div>

        <div class="absolute bottom-4 right-4">
            <button onclick="toggleAudio()" id="audio-btn" class="p-3 bg-white bg-opacity-80 rounded-full shadow-md hover:bg-opacity-100 transition tooltip">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
                <span class="tooltiptext">Togol Audio</span>
            </button>
        </div>

        <audio id="bg-music" loop>
            <source src="https://arleta.site/interactivelink/1262/Middle-Eastern-Music-Instrumental-Palm-Sanctuary.mp3" type="audio/mpeg">
        </audio>

        <audio id="correct-sound">
            <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
        </audio>

        <audio id="wrong-sound">
            <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        // Story dialogues data
        const dialogues = [
            {
                speaker: 'Ali',
                text: 'Assalamualaikum Aisyah! Hari ini kita akan belajar tentang <span class="font-bold text-green-600">I\'sm</span> dalam Bahasa Arab. I\'sm bermaksud kata nama. Ia boleh merujuk kepada orang, tempat, benda, atau konsep.',
                activeCharacter: 'ali',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124642.png'
            },
            {
                speaker: 'Aisyah',
                text: 'Betul Ali! Contoh I\'sm termasuk <span class="arabic-text text-green-600">كِتَابٌ</span> (kitab - buku), <span class="arabic-text text-green-600">مَدْرَسَةٌ</span> (madrasah - sekolah), dan <span class="arabic-text text-green-600">وَلَدٌ</span> (walad - anak lelaki).',
                activeCharacter: 'aisyah',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124629.png'
            },
            {
                speaker: 'Ali',
                text: 'I\'sm juga mempunyai jenis (muzakkar/muannath) dan bilangan (mufrad/tasniyah/jamak). Hari ini kita fokus pada <span class="font-bold text-purple-600">Dhamir</span> (kata ganti nama) yang termasuk dalam I\'sm.',
                activeCharacter: 'ali',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124642.png'
            },
            {
                speaker: 'Aisyah',
                text: 'Dhamir ialah kata ganti yang mewakili kata nama. Contohnya:',
                list: [
                    '<span class="arabic-text text-green-600">هُوَ</span> (huwa - dia lelaki)',
                    '<span class="arabic-text text-green-600">هِيَ</span> (hiya - dia perempuan)',
                    '<span class="arabic-text text-green-600">نَحْنُ</span> (nahnu - kami)'
                ],
                activeCharacter: 'aisyah',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124629.png'
            },
            {
                speaker: 'Ali',
                text: 'Mari kita lihat senarai penuh Dhamir:',
                grid: [
                    '<span class="arabic-text font-bold text-green-600">أَنَا</span> (ana - saya)',
                    '<span class="arabic-text font-bold text-green-600">نَحْنُ</span> (nahnu - kami)',
                    '<span class="arabic-text font-bold text-green-600">أَنْتَ</span> (anta - awak lelaki)',
                    '<span class="arabic-text font-bold text-green-600">أَنْتِ</span> (anti - awak perempuan)',
                    '<span class="arabic-text font-bold text-green-600">هُوَ</span> (huwa - dia lelaki)',
                    '<span class="arabic-text font-bold text-green-600">هِيَ</span> (hiya - dia perempuan)',
                    '<span class="arabic-text font-bold text-green-600">هُمَا</span> (huma - mereka berdua)',
                    '<span class="arabic-text font-bold text-green-600">هُمْ</span> (hum - mereka lelaki)',
                    '<span class="arabic-text font-bold text-green-600">هُنَّ</span> (hunna - mereka perempuan)'
                ],
                activeCharacter: 'ali',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124642.png'
            },
            {
                speaker: 'Aisyah',
                text: 'Sekarang mari uji pengetahuan kamu dengan kuiz ini! Kami akan tunjukkan contoh ayat dan kamu perlu mengenal pasti I\'sm atau Dhamir dalam ayat tersebut.',
                activeCharacter: 'aisyah',
                image: 'https://arleta.site/interactivelink/1262/IMG_20250705_124629.png',
                isLast: true
            }
        ];

        // Quiz questions data
        const quizQuestions = [
            {
                id: 1,
                question: "1. Apakah maksud I'sm dalam Bahasa Arab?",
                options: [
                    { text: "A. Kata nama", correct: true },
                    { text: "B. Kata kerja", correct: false },
                    { text: "C. Kata sifat", correct: false }
                ],
                explanation: "I'sm dalam Bahasa Arab bermaksud kata nama yang merujuk kepada orang, tempat, benda, atau konsep."
            },
            {
                id: 2,
                question: "2. Manakah berikut yang BUKAN contoh I'sm?",
                options: [
                    { text: "A. <span class='arabic-text'>كِتَابٌ</span> (kitab)", correct: false },
                    { text: "B. <span class='arabic-text'>يَكْتُبُ</span> (yaktubu)", correct: true },
                    { text: "C. <span class='arabic-text'>مَدْرَسَةٌ</span> (madrasah)", correct: false }
                ],
                explanation: "<span class='arabic-text'>يَكْتُبُ</span> (yaktubu) bermaksud 'dia menulis' dan merupakan kata kerja (fi'il), bukan kata nama (I'sm)."
            },
            {
                id: 3,
                question: "3. Apakah dhamir untuk 'awak perempuan'?",
                options: [
                    { text: "A. <span class='arabic-text'>أَنْتَ</span> (anta)", correct: false },
                    { text: "B. <span class='arabic-text'>أَنْتِ</span> (anti)", correct: true },
                    { text: "C. <span class='arabic-text'>هِيَ</span> (hiya)", correct: false }
                ],
                explanation: "<span class='arabic-text'>أَنْتِ</span> (anti) ialah dhamir untuk 'awak perempuan' manakala <span class='arabic-text'>أَنْتَ</span> (anta) untuk lelaki dan <span class='arabic-text'>هِيَ</span> (hiya) untuk 'dia perempuan'."
            },
            {
                id: 4,
                question: "4. Dalam ayat: <span class='highlight arabic-text'>هِيَ تَقْرَأُ الكِتَابَ</span> (hiya taqra'u al-kitaba), apakah kata ganti nama (dhamir)?",
                options: [
                    { text: "A. <span class='arabic-text'>هِيَ</span> (hiya)", correct: true },
                    { text: "B. <span class='arabic-text'>تَقْرَأُ</span> (taqra'u)", correct: false },
                    { text: "C. <span class='arabic-text'>الكِتَابَ</span> (al-kitaba)", correct: false }
                ],
                explanation: "<span class='arabic-text'>هِيَ</span> (hiya) ialah dhamir yang bermaksud 'dia perempuan'. <span class='arabic-text'>تَقْرَأُ</span> (taqra'u) ialah kata kerja 'membaca', dan <span class='arabic-text'>الكِتَابَ</span> (al-kitaba) ialah kata nama 'buku'."
            },
            {
                id: 5,
                question: "5. Dalam ayat: <span class='highlight arabic-text'>نَحْنُ نَلْعَبُ فِي الحَدِيقَةِ</span> (nahnu nal'abu fi al-hadiqati), apakah kata nama (I'sm) dalam ayat ini?",
                options: [
                    { text: "A. <span class='arabic-text'>نَحْنُ</span> (nahnu)", correct: false },
                    { text: "B. <span class='arabic-text'>نَلْعَبُ</span> (nal'abu)", correct: false },
                    { text: "C. <span class='arabic-text'>الحَدِيقَةِ</span> (al-hadiqati)", correct: true }
                ],
                explanation: "<span class='arabic-text'>الحَدِيقَةِ</span> (al-hadiqati) bermaksud 'taman' dan merupakan kata nama (I'sm). <span class='arabic-text'>نَحْنُ</span> (nahnu) ialah kata ganti nama 'kami', dan <span class='arabic-text'>نَلْعَبُ</span> (nal'abu) ialah kata kerja 'kami bermain'."
            },
            {
                id: 6,
                question: "6. Pilih ayat yang mengandungi dhamir <span class='highlight arabic-text'>هُمْ</span> (hum):",
                options: [
                    { text: "A. <span class='arabic-text'>هُمْ يَذْهَبُونَ إِلَى المَدْرَسَةِ</span> (hum yadhhabuna ila al-madrasati)", correct: true },
                    { text: "B. <span class='arabic-text'>أَنَا أُحِبُّ القِرَاءَةَ</span> (ana uhibbu al-qira'ata)", correct: false },
                    { text: "C. <span class='arabic-text'>الكِتَابُ عَلَى الطَّاوِلَةِ</span> (al-kitabu ala al-tawilati)", correct: false }
                ],
                explanation: "<span class='arabic-text'>هُمْ يَذْهَبُونَ إِلَى المَدْرَسَةِ</span> (hum yadhhabuna ila al-madrasati) bermaksud 'mereka (lelaki) pergi ke sekolah' dan mengandungi dhamir <span class='arabic-text'>هُمْ</span>."
            },
            {
                id: 7,
                question: "7. Dalam ayat: <span class='highlight arabic-text'>أَيْنَ أَنْتَ يَا أَحْمَدُ؟</span> (ayna anta ya Ahmadu?), apakah jenis kata <span class='highlight arabic-text'>أَحْمَدُ</span> (Ahmadu)?",
                options: [
                    { text: "A. Kata ganti nama (dhamir)", correct: false },
                    { text: "B. Kata nama khas (I'sm alam)", correct: true },
                    { text: "C. Kata kerja (fi'il)", correct: false }
                ],
                explanation: "<span class='arabic-text'>أَحْمَدُ</span> (Ahmadu) ialah nama khas (I'sm alam) untuk orang. <span class='arabic-text'>أَنْتَ</span> (anta) dalam ayat ini ialah kata ganti nama 'awak'."
            },
            {
                id: 8,
                question: "8. Pilih terjemahan yang betul untuk: <span class='highlight arabic-text'>الكُتُبُ عَلَى الرَّفِّ</span> (al-kutubu ala al-raffi)",
                options: [
                    { text: "A. Buku-buku di atas rak", correct: true },
                    { text: "B. Buku itu di atas meja", correct: false },
                    { text: "C. Saya membaca buku", correct: false }
                ],
                explanation: "<span class='arabic-text'>الكُتُبُ</span> (al-kutubu) bermaksud 'buku-buku' (jamak), <span class='arabic-text'>عَلَى</span> (ala) bermaksud 'di atas', dan <span class='arabic-text'>الرَّفِّ</span> (al-raffi) bermaksud 'rak'. Jadi terjemahan tepat ialah 'Buku-buku di atas rak'."
            },
            {
                id: 9,
                question: "9. Manakah pasangan yang BETUL antara dhamir dan contoh penggunaannya?",
                options: [
                    { text: "A. <span class='arabic-text'>أَنْتِ</span> - <span class='highlight arabic-text'>أَنْتِ طَالِبَةٌ</span> (anti talibatun - Awak pelajar perempuan)", correct: true },
                    { text: "B. <span class='arabic-text'>هِيَ</span> - <span class='highlight arabic-text'>هِيَ طَالِبٌ</span> (hiya talibun - Dia pelajar lelaki)", correct: false },
                    { text: "C. <span class='arabic-text'>هُمْ</span> - <span class='highlight arabic-text'>هُمْ طَالِبَةٌ</span> (hum talibatun - Mereka pelajar perempuan)", correct: false }
                ],
                explanation: "Pasangan yang betul ialah <span class='arabic-text'>أَنْتِ</span> - <span class='highlight arabic-text'>أَنْتِ طَالِبَةٌ</span>. <span class='arabic-text'>هِيَ</span> sepatutnya dengan muannath (<span class='arabic-text'>هِيَ طَالِبَةٌ</span>) dan <span class='arabic-text'>هُمْ</span> sepatutnya dengan muzakkar (<span class='arabic-text'>هُمْ طَالِبُونَ</span>)."
            },
            {
                id: 10,
                question: "10. Dalam ayat: <span class='highlight arabic-text'>ذَلِكَ بَيْتٌ كَبِيرٌ</span> (zalika baytun kabirun), apakah jenis kata <span class='highlight arabic-text'>ذَلِكَ</span> (zalika)?",
                options: [
                    { text: "A. Kata tunjuk (Ism isharah)", correct: true },
                    { text: "B. Kata ganti nama (Dhamir)", correct: false },
                    { text: "C. Kata nama khas (Ism alam)", correct: false }
                ],
                explanation: "<span class='arabic-text'>ذَلِكَ</span> (zalika) bermaksud 'itu' (untuk benda jauh) dan merupakan kata tunjuk (Ism isharah), sejenis kata nama khusus."
            }
        ];

        // Game state
        let currentDialogue = 0;
        let currentQuestion = 0;
        let score = 0;
        let isTyping = false;
        let typingInterval;
        let userAnswers = {};
        let audioEnabled = false;

        // DOM elements
        const frontPage = document.getElementById('front-page');
        const learningModule = document.getElementById('learning-module');
        const storySection = document.getElementById('story-section');
        const quizSection = document.getElementById('quiz-section');
        const dialogContainer = document.querySelector('.dialog-container');
        const nextBtn = document.getElementById('next-btn');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const quizQuestionsContainer = document.getElementById('quiz-questions-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const finalResult = document.getElementById('final-result');
        const scoreText = document.getElementById('score-text');
        const resultDetails = document.getElementById('result-details');
        const aliCharacter = document.getElementById('ali-character');
        const aisyahCharacter = document.getElementById('aisyah-character');
        const bgMusic = document.getElementById('bg-music');
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');
        const audioBtn = document.getElementById('audio-btn');
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const loadingScreen = document.getElementById('loading-screen');

        // Initialize the application
        function initApp() {
            // Hide loading screen after everything is loaded
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1500);
            
            // Set up event listeners
            setupEventListeners();
        }

        // Set up event listeners
        function setupEventListeners() {
            nextBtn.addEventListener('click', handleNextButton);
            nextQuestionBtn.addEventListener('click', handleNextQuestion);
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    if (!learningModule.classList.contains('hidden') && !quizSection.classList.contains('hidden')) {
                        if (!nextQuestionBtn.classList.contains('hidden') && nextQuestionBtn.offsetParent !== null) {
                            handleNextQuestion();
                        }
                    } else if (!learningModule.classList.contains('hidden') && !storySection.classList.contains('hidden')) {
                        handleNextButton();
                    }
                }
            });
            
            // Audio button tooltip
            audioBtn.addEventListener('mouseenter', () => {
                const tooltip = audioBtn.querySelector('.tooltiptext');
                tooltip.style.visibility = 'visible';
                tooltip.style.opacity = '1';
            });
            
            audioBtn.addEventListener('mouseleave', () => {
                const tooltip = audioBtn.querySelector('.tooltiptext');
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        }

        // Go to home page function
        function goToHome() {
            // Reset game state
            currentDialogue = 0;
            currentQuestion = 0;
            score = 0;
            userAnswers = {};
            
            // Reset UI
            learningModule.classList.add('hidden');
            quizSection.classList.add('hidden');
            finalResult.classList.add('hidden');
            storySection.classList.remove('hidden');
            frontPage.classList.remove('hidden');
            
            // Reset all questions
            quizQuestions.forEach(q => {
                const questionEl = document.getElementById(`question-${q.id}`);
                if (questionEl) {
                    questionEl.classList.remove('active');

                    const buttons = questionEl.querySelectorAll('.answer-btn');
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('correct', 'incorrect');
                        btn.classList.add('hover:bg-gray-100');
                    });

                    const resultEl = document.getElementById(`result-${q.id}`);
                    if (resultEl) {
                        resultEl.classList.remove('show');
                        resultEl.innerHTML = '';
                    }
                }
            });

            // Reset progress
            progressBar.style.width = '0%';
            progressText.textContent = '0/10';
            nextBtn.textContent = 'Seterusnya';
            nextBtn.classList.remove('pulse');
            nextQuestionBtn.classList.add('hidden');
            
            // Stop background music
            if (audioEnabled) {
                bgMusic.pause();
                audioEnabled = false;
                audioBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
                    </svg>
                `;
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Start game function - switches from front page to learning module
        function startGame() {
            frontPage.classList.add('hidden');
            learningModule.classList.remove('hidden');
            initStory();
        }

        // Initialize the story
        function initStory() {
            showDialogue(0);
            createQuizQuestions();
            
            // Try to autoplay music (may not work due to browser restrictions)
            const playAudio = () => {
                bgMusic.volume = 0.3;
                bgMusic.play().catch(e => console.log("Autoplay prevented:", e));
            };
            
            // Try to play after user interaction
            document.addEventListener('click', () => {
                playAudio();
                document.removeEventListener('click', playAudio);
            }, { once: true });
        }

        // Show dialogue with typing effect
        function showDialogue(index) {
            if (index >= dialogues.length) return;

            const dialogue = dialogues[index];
            const isAli = dialogue.activeCharacter === 'ali';

            // Highlight active character
            aliCharacter.classList.toggle('active', isAli);
            aisyahCharacter.classList.toggle('active', !isAli);

            // Create dialogue element
            const dialogEl = document.createElement('div');
            dialogEl.className = 'dialog';
            dialogEl.innerHTML = `
                <img src="${dialogue.image}" alt="${dialogue.speaker}" />
                <div class="dialog-content">
                    <p class="text-gray-800">
                        <span class="font-bold ${isAli ? 'text-blue-600' : 'text-pink-600'}">${dialogue.speaker}:</span> 
                        <span id="dialogue-text"></span>
                    </p>
                    ${dialogue.list ? `<ul class="list-disc pl-6 mt-2 space-y-1">${dialogue.list.map(item => `<li class="arabic-text">${item}</li>`).join('')}</ul>` : ''}
                    ${dialogue.grid ? `<div class="grid grid-cols-2 gap-3 mt-3">${dialogue.grid.map(item => `<div class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm arabic-text text-center">${item}</div>`).join('')}</div>` : ''}
                </div>
            `;

            // Clear container and add new dialogue
            dialogContainer.innerHTML = '';
            dialogContainer.appendChild(dialogEl);

            // Start typing effect
            const textEl = dialogEl.querySelector('#dialogue-text');
            const fullText = dialogue.text;
            let charIndex = 0;

            isTyping = true;
            textEl.classList.add('typing');

            typingInterval = setInterval(() => {
                if (charIndex < fullText.length) {
                    textEl.innerHTML = fullText.substring(0, charIndex + 1);
                    charIndex++;
                    // Scroll to bottom
                    dialogContainer.scrollTop = dialogContainer.scrollHeight;
                } else {
                    clearInterval(typingInterval);
                    textEl.classList.remove('typing');
                    isTyping = false;

                    // Update next button if last dialogue
                    if (dialogue.isLast) {
                        nextBtn.textContent = 'Mulakan Kuiz';
                        nextBtn.classList.add('pulse');
                    }
                }
            }, 20);

            // Show the dialogue
            setTimeout(() => {
                dialogEl.classList.add('active');
            }, 100);

            currentDialogue = index;
        }

        // Create quiz questions
        function createQuizQuestions() {
            quizQuestions.forEach((question, index) => {
                const questionEl = document.createElement('div');
                questionEl.className = `question-container bg-white rounded-lg shadow-lg p-6 ${index === 0 ? 'active' : ''}`;
                questionEl.id = `question-${question.id}`;
                questionEl.innerHTML = `
                    <h3 class="font-bold text-lg mb-4 text-gray-800">${question.question}</h3>
                    <div class="space-y-3">
                        ${question.options.map((option, optIndex) => `
                            <button class="quiz-button answer-btn w-full text-left bg-gray-50 hover:bg-gray-100 rounded-lg p-4 border border-gray-200 transition-all"
                                onclick="selectAnswer(${question.id}, ${optIndex}, ${option.correct})"
                                data-question="${question.id}" 
                                data-option="${optIndex}">
                                <span class="flex items-center">
                                    <span class="mr-3 font-semibold">${option.text.split('.')[0]}.</span>
                                    <span>${option.text.split('.').slice(1).join('.')}</span>
                                </span>
                            </button>
                        `).join('')}
                    </div>
                    <div id="result-${question.id}" class="quiz-result mt-4"></div>
                `;
                quizQuestionsContainer.appendChild(questionEl);
            });
        }

        // Next button handler
        function handleNextButton() {
            if (isTyping) {
                // Finish typing immediately
                clearInterval(typingInterval);
                const textEl = document.querySelector('#dialogue-text');
                textEl.innerHTML = dialogues[currentDialogue].text;
                textEl.classList.remove('typing');
                isTyping = false;

                if (dialogues[currentDialogue]?.isLast) {
                    nextBtn.textContent = 'Mulakan Kuiz';
                    nextBtn.classList.add('pulse');
                }
                return;
            }

            if (dialogues[currentDialogue]?.isLast) {
                // Start quiz
                storySection.classList.add('hidden');
                quizSection.classList.remove('hidden');
                updateProgress();
                
                // Scroll to first question
                document.getElementById(`question-${quizQuestions[0].id}`).scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                return;
            }

            showDialogue(currentDialogue + 1);
        }

        // Next question button handler
        function handleNextQuestion() {
            if (currentQuestion < quizQuestions.length - 1) {
                document.getElementById(`question-${quizQuestions[currentQuestion].id}`).classList.remove('active');
                currentQuestion++;
                document.getElementById(`question-${quizQuestions[currentQuestion].id}`).classList.add('active');
                nextQuestionBtn.classList.add('hidden');
                updateProgress();

                // Scroll to question
                document.getElementById(`question-${quizQuestions[currentQuestion].id}`).scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            } else {
                showFinalResult();
            }
        }

        // Select answer handler
        function selectAnswer(questionId, optionIndex, isCorrect) {
            const question = quizQuestions.find(q => q.id === questionId);
            const resultEl = document.getElementById(`result-${questionId}`);
            const selectedButton = document.querySelector(`button[data-question="${questionId}"][data-option="${optionIndex}"]`);

            // Play sound effect
            if (audioEnabled) {
                if (isCorrect) {
                    correctSound.currentTime = 0;
                    correctSound.play();
                } else {
                    wrongSound.currentTime = 0;
                    wrongSound.play();
                }
            }

            // Record user answer
            userAnswers[questionId] = {
                selectedOption: optionIndex,
                isCorrect: isCorrect
            };

            // Disable all buttons for this question
            const buttons = document.querySelectorAll(`#question-${questionId} .answer-btn`);
            buttons.forEach(button => {
                button.disabled = true;
                button.classList.remove('hover:bg-gray-100');
            });

            // Highlight selected answer
            if (isCorrect) {
                selectedButton.classList.add('correct');
            } else {
                selectedButton.classList.add('incorrect');
                // Also highlight the correct answer
                const correctIndex = question.options.findIndex(opt => opt.correct);
                document.querySelector(`button[data-question="${questionId}"][data-option="${correctIndex}"]`).classList.add('correct');
            }

            // Show result
            resultEl.innerHTML = `
                <div class="${isCorrect ? 'bg-green-50 text-green-800 border-green-200' : 'bg-red-50 text-red-800 border-red-200'} p-4 rounded-lg border">
                    ${isCorrect ? 
                        '<div class="flex items-center font-bold"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>Betul!</div>' : 
                        '<div class="flex items-center font-bold"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>Kurang tepat.</div>'} 
                    <div class="mt-1">${question.explanation}</div>
                </div>
            `;
            resultEl.classList.add('show');

            // Update score
            if (isCorrect) {
                score++;
            }

            // Show next question button
            nextQuestionBtn.classList.remove('hidden');

            // Update progress
            updateProgress();
        }

        // Update progress bar and text
        function updateProgress() {
            const progress = ((currentQuestion + 1) / quizQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${currentQuestion + 1}/${quizQuestions.length}`;
        }

        // Show final result
        function showFinalResult() {
            quizSection.classList.add('hidden');
            finalResult.classList.remove('hidden');

            const percentage = Math.round((score / quizQuestions.length) * 100);
            scoreText.innerHTML = `${score}<span class="text-2xl">/${quizQuestions.length}</span>`;
            
            // Update result based on score
            if (percentage >= 70) {
                resultIcon.className = 'h-16 w-16 text-yellow-500';
                resultIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                `;
                resultTitle.textContent = 'Tahniah!';
                resultMessage.textContent = `Anda telah berjaya menamatkan kuiz ini dengan cemerlang (${percentage}%)!`;
                createConfetti();
            } else if (percentage >= 50) {
                resultIcon.className = 'h-16 w-16 text-blue-500';
                resultIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                `;
                resultTitle.textContent = 'Baik!';
                resultMessage.textContent = `Anda telah menamatkan kuiz ini dengan baik (${percentage}%). Teruskan berusaha!`;
            } else {
                resultIcon.className = 'h-16 w-16 text-red-500';
                resultIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                `;
                resultTitle.textContent = 'Teruskan Berusaha!';
                resultMessage.textContent = `Anda telah menamatkan kuiz ini dengan skor ${percentage}%. Jangan putus asa, teruskan mencuba!`;
            }

            // Show result details
            resultDetails.innerHTML = `
                <p class="font-semibold mb-3 text-gray-700">Ringkasan Jawapan:</p>
                <div class="space-y-3">
                    ${quizQuestions.map(q => {
                        const userAnswer = userAnswers[q.id];
                        const isCorrect = userAnswer?.isCorrect || false;
                        const selectedOption = q.options[userAnswer?.selectedIndex]?.text || 'Tiada jawapan';
                        const correctOption = q.options.find(opt => opt.correct)?.text;

                        return `
                            <div class="${isCorrect ? 'bg-green-50' : 'bg-red-50'} p-3 rounded-lg">
                                <div class="font-medium ${isCorrect ? 'text-green-700' : 'text-red-700'}">Soalan ${q.id}: ${isCorrect ? 'Betul' : 'Salah'}</div>
                                ${!isCorrect ? `<div class="text-sm mt-1">Jawapan anda: ${selectedOption.split('.')[0]}.${selectedOption.split('.').slice(1).join('.')}</div>` : ''}
                                <div class="text-sm mt-1">${q.explanation}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            // Scroll to result
            finalResult.scrollIntoView({ behavior: 'smooth' });
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Toggle audio
        function toggleAudio() {
            audioEnabled = !audioEnabled;
            
            if (audioEnabled) {
                bgMusic.play();
                audioBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                `;
            } else {
                bgMusic.pause();
                audioBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
                    </svg>
                `;
            }
        }

        // Share result
        function shareResult() {
            const percentage = Math.round((score / quizQuestions.length) * 100);
            const shareText = `Saya telah berjaya menjawab ${score} daripada ${quizQuestions.length} soalan (${percentage}%) dalam Kuiz Bahasa Arab: I'sm!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Keputusan Kuiz Bahasa Arab',
                    text: shareText,
                    url: window.location.href
                }).catch(err => {
                    console.log('Error sharing:', err);
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Keputusan telah disalin ke clipboard!\n' + text);
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }

        // Reset quiz
        function resetQuiz() {
            // Reset game state
            currentQuestion = 0;
            score = 0;
            userAnswers = {};

            // Reset UI
            finalResult.classList.add('hidden');
            quizSection.classList.remove('hidden');
            storySection.classList.remove('hidden');

            // Reset all questions
            quizQuestions.forEach(q => {
                const questionEl = document.getElementById(`question-${q.id}`);
                questionEl.classList.remove('active');

                const buttons = questionEl.querySelectorAll('.answer-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'incorrect');
                    btn.classList.add('hover:bg-gray-100');
                });

                const resultEl = document.getElementById(`result-${q.id}`);
                resultEl.classList.remove('show');
                resultEl.innerHTML = '';
            });

            // Show first question and first dialogue
            document.getElementById(`question-${quizQuestions[0].id}`).classList.add('active');
            nextQuestionBtn.classList.add('hidden');
            nextBtn.classList.remove('pulse');
            nextBtn.textContent = 'Seterusnya';
            showDialogue(0);
            updateProgress();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);

        // Make functions available globally for HTML onclick
        window.selectAnswer = selectAnswer;
        window.resetQuiz = resetQuiz;
        window.toggleAudio = toggleAudio;
        window.shareResult = shareResult;
        window.startGame = startGame;
        window.goToHome = goToHome;
    </script>
</body>
</html>
